<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record id="account_payment_form_inherit_ntp_payable_management" model="ir.ui.view">
        <field name="name">account.payment.view.form.inherit</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_form"/>
        <field name="arch" type="xml">
            <xpath expr="//header" position="inside">
                <button string="Update Bank" name="button_open_update_bank_wizard" type="object" attrs="{'invisible': ['|', ('show_partner_bank_account', '=', False), ('state', '!=', 'draft')]}" />
            </xpath>
            <div name="button_box" position="inside">
                <button name="button_open_bill_source" type="object" class="oe_stat_button" icon="fa-bars">
                    Bill Source
                </button>
            </div>
            <xpath expr="//field[@name='partner_bank_id'][last()]" position="after">
                <field name="plan_week_id" readonly="1" />
                <field name="plan_month_id" readonly="1" />
                <field name="payment_score" />
            </xpath>
        </field>
    </record>

    <record id="account_payment_tree_inherit_ntp_payable_management" model="ir.ui.view">
        <field name="name">account.payment.view.tree.inherit</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_supplier_payment_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='batch_payment_id']" position="after">
                <field name="plan_week_id" optional="hide" />
                <field name="plan_month_id" optional="hide" />
                <field name="payment_score" optional="hide" />
                <field name="payment_late_days" optional="hide" />
                <field name="draft_account_move_id" optional="hide" />
            </xpath>
        </field>
    </record>

    <!-- GRAPH -->
    <record id="account_payment_graph_inherit_ntp_payable_management" model="ir.ui.view">
        <field name="name">account.payment.view.graph.inherit</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_graph"/>
        <field name="arch" type="xml">
            <xpath expr="//graph" position="attributes">
                <!-- <attribute name="type">pivot</attribute> -->
                <attribute name="stacked">True</attribute>
            </xpath>
            <field name="payment_type" position="replace">
                <field name="paid_date" type="row" interval="week" />
            </field>
            <field name="journal_id" position="replace">
                <field name="transfer_status" type="col" />
            </field>
        </field>
    </record>

    <!-- KANBAN -->
    <record id="view_account_payment_kanban_inherit_ntp_payable_management" model="ir.ui.view">
        <field name="name">account.payment.view.kanban.inherit</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_kanban"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="class" value="o_kanban_small_column"></attribute>
                <attribute name="create" remove="0"></attribute>
                <attribute name="group_create" remove="0"></attribute>
                <!-- <attribute name="group_create" remove="1"></attribute> -->
                <attribute name="group_delete">false</attribute>
                <!-- <attribute name="on_create">quick_create</attribute> -->
                <!-- <attribute name="quick_create_view">ntp_payable_management.account_payment_form_inherit_ntp_payable_management</attribute> -->
                <attribute name="default_group_by">plan_week_id</attribute>
                <attribute name="disable_sort_column">1</attribute>
                <attribute name="js_class">plan_kanban</attribute>
                <attribute name="default_order">amount_total_signed desc</attribute>
            </xpath>
            <xpath expr="//templates" position="before">
                <field name="transfer_status" />
                <field name="currency_id" />
                <field name="payment_late_days" />
                <field name="amount_total_signed" />
                <field name="amount_company_currency_signed" />
                <progressbar field="transfer_status"
                             colors='{"prepare": "info", "transferring": "warning", "transferred": "success", "reconciled": "primary"}'
                             sum_field="amount_total_signed" help="This bar allows to filter the transfer status of payment."/>
                <!-- <progressbar field="state"
                             colors='{"draft": "info", "cancel": "warning", "posted": "success"}'
                             sum_field="amount" help="This bar allows to filter the transfer status of payment."/> -->
            </xpath>
            <xpath expr="//field[@name='amount']" position="replace">
                <field name="amount" widget='monetary' invisible="1"/>
                <field name="currency_id" invisible="1"/>
                <!-- <field name="amount_total_signed" widget='monetary'/> -->
                <field name="amount_company_currency_signed" widget='monetary'/>
                <field name="company_currency_id" invisible="1"/>
            </xpath>
            <xpath expr="//templates/t/div" position="inside">
                <div class="row">
                    <div class="col-12">
                        <span><u>Memo:</u> <field name="ref"/></span>
                    </div>
                </div>
                <!-- <div class="row">
                    <div class="col-12">
                        <span><field name="transfer_content"/></span>
                    </div>
                </div> -->
                <div class="row">
                    <div class="o_dropdown_kanban dropdown">
                        <a class="dropdown-toggle o-no-caret btn" role="button" data-toggle="dropdown" data-display="static" href="#" aria-label="Dropdown menu" title="Dropdown menu">
                            <span class="fa fa-ellipsis-v"/>
                        </a>
                        <div class="dropdown-menu" role="menu">
                            <t t-if="widget.editable"><a role="menuitem" type="edit" class="dropdown-item">Edit</a></t>
                            <t t-if="widget.deletable"><a role="menuitem" type="delete" class="dropdown-item">Delete</a></t>
                            <!-- <ul class="oe_kanban_colorpicker" data-field="color"/> -->
                        </div>
                    </div>
                    <div class="col-6">
                        <!-- <t t-if="record.payment_late_days &lt; 0">
                            <field name="payment_late_days" widget="label_selection" />
                        </t> -->
                        <!-- <t t-if="record.payment_late_days.raw_value &lt; 0">
                            <field name="payment_late_days"
                               widget="label_selection" />
                        </t> -->
                    </div>
                    <div class="col-6">
                        <span class="float-right">
                            <div class="o_field_widget badge badge-warning"
                                 attrs="{'invisible': [('payment_late_days', '&gt;=', 0)]}"
                                 aria-label="This is late payment" title="This is late payment">
                                Late <span t-esc="Math.abs(record.payment_late_days.value)"></span> days
                            </div>
                        </span>
                    </div>
                </div>
            </xpath>
            <xpath expr="//templates//field[@name='state']" position="before">
                <field name="transfer_status"
                       widget="label_selection"
                       options="{'classes': {'prepare': 'info', 'transferring': 'warning', 'transferred': 'success', 'reconciled': 'primary'}}" />
            </xpath>
        </field>
    </record>

    <!-- SEARCH -->
    <record id="view_account_payment_search_inherit_ntp_payable_management" model="ir.ui.view">
        <field name="name">account.payment.view.search.inherit</field>
        <field name="model">account.payment</field>
        <field name="inherit_id" ref="account.view_account_payment_search"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="inside">
                <separator />
                <filter name="plan_week_id" string="Plan Week" context="{'group_by': 'plan_week_id'}" />
                <filter name="plan_month_id" string="Plan Month" context="{'group_by': 'plan_month_id'}" />
                <!-- <filter name="plan_quarter" string="Plan Quarter" context="{'group_by': 'plan_quarter'}" /> -->
                <!-- <filter name="plan_year" string="Plan Year" context="{'group_by': 'plan_year'}" /> -->
            </xpath>
        </field>
    </record>

</odoo>
